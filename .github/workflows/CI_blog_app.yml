name: Blog CI
run-name: Blog is testing out GitHub Actions
on:
    push:
        branches: [ main ]
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - name: Runner OS
          run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
        - name: Check out repository code
          uses: actions/checkout@v3
        - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
        - name: View repository contents
          run: ls -la
        - name: Build Docker image
          run: docker build -t blogs-app:latest ./blogs 
        - name: Test container
          run: |
            docker run -d --name test-mongodb mongo:4.4
            docker run -d --name test-blog-app --link test-mongodb -e DB_HOST=test-mongodb blogs-app:latest
            sleep 20
            echo "ğŸ“ Testing GET /blogs endpoint..."
            curl -s "http://localhost:3000/blogs?pageSize=2" | jq '.'
            echo ""
            echo "âœ… GET /blogs completed"